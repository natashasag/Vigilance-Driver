<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vigilance Driver - Dashboard</title>

  <!-- CSS -->
  <link rel="stylesheet" href="./styles.css">

  <!-- Face API -->
  <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>

  <!-- App JS -->
  <script src="app.js"></script>
</head>

<body>

  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-brand">
      <span style="font-size:28px;">üëÅ</span>
      <div>
        <h1>Driver Drowsiness Detection</h1>
        <p>Real-time EAR & Facial Landmark Monitoring</p>
      </div>
    </div>
    <div class="header-actions">
      <span class="status-online">üü¢ Online</span>
      <button class="btn-privacy" onclick="togglePrivacy()">üõ° Privacy Mode üëÅ</button>
      <button class="btn-signout" onclick="signOut()">üö™ Sign Out</button>
    </div>
  </header>

  <!-- Dashboard Grid -->
  <div class="dashboard-grid">

    <!-- Left Column -->
    <div class="left-column">

      <!-- Video Feed Section -->
      <div class="glass">

        <!-- Video Feed -->
        <div class="video-container" style="position:relative">
          <video id="video" muted playsinline></video>

          <canvas id="overlayCanvas"
            style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none">
          </canvas>

          <div class="video-placeholder" id="placeholder">
            <span style="font-size:32px;">üëÅ</span>
            <p id="placeholderText">Loading face detection models...</p>
          </div>
        </div>
      </div>

      <!-- Start/Stop Button (NOW BELOW VIDEO) -->
      <button id="toggleBtn" class="btn-start" onclick="toggleDetection()">
        üì∑ Start Detection
      </button>

      <!-- Session Log -->
      <div class="glass-card session-log">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
          <h3>üïê Session Log</h3>
          <span id="logCount">0 events</span>
        </div>
        <div id="logList">
          <p style="text-align:center;color:#888;">Start detection to see logs</p>
        </div>
      </div>

    </div>

    <!-- Right Column -->
    <div class="stats-section">

      <!-- Status -->
      <div class="stat-card">
        <h3>Current Status</h3>
        <div class="status-badge" id="statusBanner">
          Driver Alert
        </div>
      </div>

      <!-- EAR -->
      <div class="stat-card">
        <h3>Eye Aspect Ratio (EAR)</h3>
        <div class="stat-value" id="earValue">0.000</div>
        <p id="earStatus">Threshold: 0.25 | Eyes Open</p>
        <div class="progress-bar">
          <div class="progress-fill" id="earBar" style="width:0%"></div>
        </div>
      </div>

      <!-- Drowsiness Score -->
      <div class="stat-card">
        <h3>‚ö° Multi-Factor Drowsiness Score</h3>
        <div class="stat-value" id="drowsinessValue">0</div>
        <p id="fatigueLabel" style="color:#22c55e;font-weight:600;">
          Low Fatigue Level
        </p>
        <div class="progress-bar">
          <div class="progress-fill" id="drowsinessBar" style="width:0%"></div>
        </div>
        <div>
          <h4>‚ö† Why this score?</h4>
          <p id="explainText">‚Ä¢ Alertness levels are normal</p>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="quick-stats">
        <div class="mini-stat">
          <div class="value" id="microSleeps">0</div>
          <div class="label">Micro-sleeps</div>
        </div>
        <div class="mini-stat">
          <div class="value" id="blinkRate">0/min</div>
          <div class="label">Blink Rate</div>
        </div>
        <div class="mini-stat">
          <div class="value" id="blinks">0</div>
          <div class="label">Blinks</div>
        </div>
        <div class="mini-stat">
          <div class="value" id="yawns">0</div>
          <div class="label">Yawns</div>
        </div>
        <div class="mini-stat">
          <div class="value" id="alerts">0</div>
          <div class="label">Alerts</div>
        </div>
        <div class="mini-stat">
          <div class="value" id="microSleeps2">0</div>
          <div class="label">Micro-sleeps</div>
        </div>
      </div>

      <!-- Head Pose -->
      <div class="stat-card">
        <h3>Head Pose Score</h3>
        <div style="display:flex;align-items:center;gap:12px;">
          <div class="progress-bar" style="flex:1;">
            <div class="progress-fill" id="headPoseBar" style="width:0%"></div>
          </div>
          <span id="headPoseValue">0%</span>
        </div>
      </div>

    </div>
  </div>

  <!-- Bottom Section -->
  <div class="bottom-grid">

    <!-- Driving Modes -->
    <div class="stat-card">
      <h3>‚öô Driving Modes</h3>

      <div class="mode-item" id="safetyMode" onclick="toggleSafety()">
        üõ° Safety Mode
      </div>

      <div class="mode-toggle" id="ecoMode" onclick="toggleEco()">
        ‚ö° Eco Mode
      </div>

      <p id="modeStatus">‚ö° Maximum protection active</p>
    </div>

    <!-- Wellness Insights -->
    <div class="stat-card">
      <h3>‚ù§ Wellness Insights</h3>
      <p id="wellnessTitle">‚ú® Great Alertness!</p>
      <small id="wellnessText">
        Your eye openness is excellent. Keep maintaining good sleep habits.
      </small>

      <div class="wellness-stats">
        <div>
          <div id="sessionTime">0m 0s</div>
          <div>Session Time</div>
        </div>
        <div>
          <div id="avgAlertness">100%</div>
          <div>Avg Alertness</div>
        </div>
      </div>
    </div>

  </div>

  <!-- How It Works -->
  <div class="how-section">
    <div class="glass-card">
      <h3>How It Works</h3>
      <code>
        EAR = (|p2-p6| + |p3-p5|) / (2 √ó |p1-p4|)
      </code>
      <p>
        When EAR drops below 0.25 for 2‚Äì3 seconds,
        drowsiness is detected.
      </p>
    </div>
  </div>

  <!-- Footer -->
 <footer class="site-footer">
    <div class="footer-grid">
      <div>
        <strong>üëÅ Vigilance Driver</strong>
        <p>
          Driver drowsiness detection system using advanced
          facial landmark analysis and Eye Aspect Ratio (EAR)
          technology.
        </p>
      </div>
      <div>
        <h4>Features</h4>
        <ul>
          <li>EAR-based Detection</li>
          <li>Micro-sleep Alerts</li>
          <li>Head Pose Tracking</li>
        </ul>
      </div>
      <div>
        <h4>Technology</h4>
        <ul>
          <li>face-api.js</li>
          <li>Flask + Python</li>
          <li>Real-time Processing</li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      ¬© 2026 Vigilance Driver. All rights reserved.
    </div>
  </footer>

</body>
</html>