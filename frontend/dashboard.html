<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vigilance Driver - Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>

</head>
<body>
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-brand">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:#22c55e"><circle cx="12" cy="12" r="3"/><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/></svg>
      <div><h1>Driver Drowsiness Detection</h1><p>Real-time EAR &amp; Facial Landmark Monitoring</p></div>
    </div>
    <div class="header-actions">
      <span class="status-online">üì∂ Online</span>
      <button class="btn-privacy">üõ° Privacy Mode üëÅ</button>
      <button class="btn-signout" onclick="logout()">‚Ü™ Sign Out</button>
    </div>
  </header>

  <div class="dashboard-grid">
    <!-- Left Column -->
    <div>
      <div class="card">
        <div class="video-container" style="position:relative">
  <video id="webcam" muted playsinline style="width:100%;height:100%;object-fit:cover"></video>
  <canvas id="overlayCanvas" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none"></canvas>
  <div class="video-placeholder" id="videoPlaceholder">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/></svg>
    <p id="modelStatus">Loading face detection models...</p>
    <p>Click Start to begin detection</p>
  </div>
</div>

      </div>
      <button class="btn-start" id="btnStart" onclick="toggleDetection()">üì∑ Start Detection</button>

      <!-- Session Log -->
      <div class="card" style="margin-top:24px">
        <div class="session-log">
          <div class="session-log-header">
            <h3>üïê Session Log</h3>
            <span id="logCount" style="color:#6b7a8d;font-size:13px">0 events</span>
          </div>
          <div class="log-entries" id="logEntries">
            <p class="log-empty">Start detection to see logs</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div>
      <!-- Status -->
      <div class="card">
        <div class="card-header">Current Status</div>
        <div class="status-badge alert" id="statusBadge">Driver Alert</div>
      </div>

      <!-- EAR -->
      <div class="card" style="margin-top:16px">
        <div class="card-header">Eye Aspect Ratio (EAR)</div>
        <div class="ear-value" id="earValue">0.300</div>
        <div class="ear-info" id="earInfo">Threshold: 0.25 | Eyes Open</div>
        <div class="progress-bar"><div class="progress-fill green" id="earFill" style="width:75%"></div></div>
      </div>

      <!-- Drowsiness Score -->
      <div class="card" style="margin-top:16px">
        <div class="card-header">‚öô Multi-Factor Drowsiness Score</div>
        <div class="drowsiness-score" id="drowsinessScore">15</div>
        <div class="fatigue-label" id="fatigueLabel" style="color:#22c55e">Low Fatigue Level</div>
        <div class="progress-bar"><div class="progress-fill green" id="drowsinessFill" style="width:15%"></div></div>
        <div class="why-section">
          <h4>‚ö† Why this score?</h4>
          <p id="whyText">‚Ä¢ Alertness levels are normal</p>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="stats-grid" style="margin-top:16px">
        <div class="stat-card"><div class="stat-value" id="statMicrosleeps">0</div><div class="stat-label">Micro-sleeps</div></div>
        <div class="stat-card"><div class="stat-value" id="statBlinkRate">0/min</div><div class="stat-label">Blink Rate</div></div>
        <div class="stat-card"><div class="stat-value" id="statBlinks">0</div><div class="stat-label">Blinks</div></div>
        <div class="stat-card"><div class="stat-value" id="statYawns">0</div><div class="stat-label">Yawns</div></div>
        <div class="stat-card"><div class="stat-value" id="statAlerts">0</div><div class="stat-label">Alerts</div></div>
        <div class="stat-card"><div class="stat-value" id="statMicrosleeps2">0</div><div class="stat-label">Micro-sleeps</div></div>
      </div>

      <!-- Head Pose -->
      <div class="card" style="margin-top:16px">
        <div class="card-header">Head Pose Score</div>
        <div class="head-pose-row">
          <div class="progress-bar head-pose-bar"><div class="progress-fill green" id="headPoseFill" style="width:100%"></div></div>
          <span class="head-pose-val" id="headPoseVal">100%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Section -->
  <div class="bottom-grid">
    <!-- Driving Modes -->
    <div class="card" style="padding:20px">
      <h3>‚öô Driving Modes</h3>
      <div style="margin-top:16px">
        <div class="mode-item active" onclick="toggleSafetyMode()">
          <div class="mode-icon green" id="safetyIcon">üõ°</div>
          <div class="mode-info"><h4>Safety Mode</h4><p>Maximum sensitivity &amp; alerts</p></div>
          <div class="toggle on" id="safetyToggle"><div class="toggle-knob"></div></div>
        </div>
        <div class="mode-item" style="margin-top:12px" onclick="toggleEcoMode()">
          <div class="mode-icon gray" id="ecoIcon">‚ö°</div>
          <div class="mode-info"><h4>Eco Mode</h4><p>Reduced processing, saves battery</p></div>
          <div class="toggle off" id="ecoToggle"><div class="toggle-knob"></div></div>
        </div>
      </div>
      <div class="mode-status" id="modeStatus">‚ö° Maximum protection active</div>
    </div>

    <!-- Wellness Insights -->
    <div class="card wellness-card">
      <h3>‚ù§ Wellness Insights</h3>
      <div class="wellness-msg" style="margin-top:16px">
        <h4>‚ú® Great Alertness!</h4>
        <p>Your eye openness is excellent. Keep maintaining good sleep habits.</p>
      </div>
      <div class="wellness-stats">
        <div><div class="wellness-stat-value" id="sessionTime">0m</div><div class="wellness-stat-label">Session Time</div></div>
        <div><div class="wellness-stat-value" id="avgAlertness">30%</div><div class="wellness-stat-label">Avg Alertness</div></div>
      </div>
    </div>
  </div>

  <!-- How It Works -->
  <div class="how-section">
    <div class="how-card">
      <h3>How It Works</h3>
      <div class="how-grid">
        <div>
          <h4>Eye Aspect Ratio (EAR) Formula:</h4>
          <code>EAR = (|p2-p6| + |p3-p5|) / (2 √ó |p1-p4|)</code>
          <p style="margin-top:8px;font-size:14px;color:#6b7a8d">When EAR drops below 0.25 for 2-3 seconds, drowsiness is detected.</p>
        </div>
        <div>
          <h4>Detection Features:</h4>
          <ul>
            <li>68-point facial landmark detection</li>
            <li>Real-time EAR &amp; MAR calculation</li>
            <li>Micro-sleep detection</li>
            <li>Head pose monitoring</li>
            <li>Multi-factor drowsiness scoring</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-grid">
      <div class="footer-brand">
        <h3>üëÅ Vigilance Driver</h3>
        <p>Driver drowsiness detection system using advanced facial landmark analysis and Eye Aspect Ratio (EAR) technology to keep drivers safe on the road.</p>
        <div class="footer-tags"><span>üõ° Privacy First</span><span>‚ö° Real-time</span></div>
      </div>
      <div class="footer-col">
        <h4>Features</h4>
        <ul><li>EAR-based Detection</li><li>Micro-sleep Alerts</li><li>Yawn Detection</li><li>Head Pose Tracking</li><li>Session Analytics</li></ul>
      </div>
      <div class="footer-col">
        <h4>Technology</h4>
        <ul><li>face-api.js</li><li>68-point Landmarks</li><li>Web Audio API</li><li>Flask + MongoDB</li><li>Real-time Processing</li></ul>
      </div>
    </div>
    <div class="footer-copy">¬© 2026 Vigilance Driver - Driver Drowsiness Detection System. All rights reserved.</div>
  </footer>

  <script src="app.js"></script>
</body>
</html>
