<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vigilance Driver - Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>

</head>
<body>
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-brand">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color:#22c55e"><circle cx="12" cy="12" r="3"/><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/></svg>
      <div><h1>Driver Drowsiness Detection</h1><p>Real-time EAR &amp; Facial Landmark Monitoring</p></div>
    </div>
    <div class="header-actions">
      <span class="status-online">üì∂ Online</span>
      <button class="btn-privacy">üõ° Privacy Mode üëÅ</button>
      <button class="btn-signout" onclick="logout()">‚Ü™ Sign Out</button>
    </div>
  </header>

  <div class="dashboard-grid">

  <!-- Left Column -->
    <div class="col-span-2 space-y-6">
       <div class="card">
         
<!-- Video Feed -->
    <div class="grid grid-cols-3 gap-6 p-6">
      <div class="relative aspect-video bg-gray-900">
        <video id="webcam" class="h-full w-full object-cover" autoplay muted playsinline></video>
        <canvas id="overlayCanvas" class="absolute inset-0 h-full w-full" style="pointer-events: none;"></canvas>
        <div id="placeholder" class="absolute inset-0 flex flex-col items-center justify-center">  </div>
          <svg class="mb-4 h-16 w-16 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          <p class="text-gray-400">Click Start to begin detection</p>
        </div>
      </div>
     
    <!-- Start/Stop Button (NOW BELOW VIDEO) -->
    <button id="toggleBtn" onclick="toggleDetection()"
      class="flex w-full items-center justify-center gap-3 rounded-xl bg-green-500 py-4 text-lg font-bold text-white transition-all hover:brightness-110">
      üì∑ Start Detection
    </button>
</div>
     <!-- Session Log -->
    <div class="glass-card p-6">
      <div class="mb-4 flex items-center justify-between">
        <h3 class="flex items-center gap-2 font-bold text-white">üïê Session Log</h3>
        <span id="logCount" class="text-sm text-gray-400">0 events</span>
      </div>
      <div id="sessionLog" class="max-h-40 space-y-2 overflow-y-auto">
        <p class="text-center text-sm text-gray-400">Start detection to see logs</p>
      </div>
    </div>
  </div>

    <!-- Right Column -->
    <div class="space-y-6">
      <!-- Status -->
      <div class="card">
        <div class="card-header">Current Status</div>
        <div class="status-badge alert" id="statusBadge">Driver Alert</div>
      </div>

      <!-- EAR -->
      <div class="card" style="margin-top:16px">
        <div class="card-header">Eye Aspect Ratio (EAR)</div>
        <div class="ear-value" id="earValue">0.300</div>
        <div class="ear-info" id="earInfo">Threshold: 0.25 | Eyes Open</div>
        <div class="progress-bar"><div class="progress-fill green" id="earFill" style="width:75%"></div></div>
      </div>

      <!-- Drowsiness Score -->
      <div class="card" style="margin-top:16px">
        <div class="card-header">‚öô Multi-Factor Drowsiness Score</div>
        <div class="drowsiness-score" id="drowsinessScore">15</div>
        <div class="fatigue-label" id="fatigueLabel" style="color:#22c55e">Low Fatigue Level</div>
        <div class="progress-bar"><div class="progress-fill green" id="drowsinessFill" style="width:15%"></div></div>
        <div class="why-section">
          <h4>‚ö† Why this score?</h4>
          <p id="whyText">‚Ä¢ Alertness levels are normal</p>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="stats-grid" style="margin-top:16px">
        <div class="stat-card"><div class="stat-value" id="statMicrosleeps">0</div><div class="stat-label">Micro-sleeps</div></div>
        <div class="stat-card"><div class="stat-value" id="statBlinkRate">0/min</div><div class="stat-label">Blink Rate</div></div>
        <div class="stat-card"><div class="stat-value" id="statBlinks">0</div><div class="stat-label">Blinks</div></div>
        <div class="stat-card"><div class="stat-value" id="statYawns">0</div><div class="stat-label">Yawns</div></div>
        <div class="stat-card"><div class="stat-value" id="statAlerts">0</div><div class="stat-label">Alerts</div></div>
        <div class="stat-card"><div class="stat-value" id="statMicrosleeps2">0</div><div class="stat-label">Micro-sleeps</div></div>
      </div>

      <!-- Head Pose -->
      <div class="card" style="margin-top:16px">
        <div class="card-header">Head Pose Score</div>
        <div class="head-pose-row">
          <div class="progress-bar head-pose-bar"><div class="progress-fill green" id="headPoseFill" style="width:100%"></div></div>
          <span class="head-pose-val" id="headPoseVal">100%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Section -->
  <div class="bottom-grid">
    <!-- Driving Modes -->
    <div class="card" style="padding:20px">
      <h3>‚öô Driving Modes</h3>
      <div style="margin-top:16px">
        <div class="mode-item active" onclick="toggleSafetyMode()">
          <div class="mode-icon green" id="safetyIcon">üõ°</div>
          <div class="mode-info"><h4>Safety Mode</h4><p>Maximum sensitivity &amp; alerts</p></div>
          <div class="toggle on" id="safetyToggle"><div class="toggle-knob"></div></div>
        </div>
        <div class="mode-item" style="margin-top:12px" onclick="toggleEcoMode()">
          <div class="mode-icon gray" id="ecoIcon">‚ö°</div>
          <div class="mode-info"><h4>Eco Mode</h4><p>Reduced processing, saves battery</p></div>
          <div class="toggle off" id="ecoToggle"><div class="toggle-knob"></div></div>
        </div>
      </div>
      <div class="mode-status" id="modeStatus">‚ö° Maximum protection active</div>
    </div>

    <!-- Wellness Insights -->
    <div class="card wellness-card">
      <h3>‚ù§ Wellness Insights</h3>
      <div class="wellness-msg" style="margin-top:16px">
        <h4>‚ú® Great Alertness!</h4>
        <p>Your eye openness is excellent. Keep maintaining good sleep habits.</p>
      </div>
      <div class="wellness-stats">
        <div><div class="wellness-stat-value" id="sessionTime">0m</div><div class="wellness-stat-label">Session Time</div></div>
        <div><div class="wellness-stat-value" id="avgAlertness">30%</div><div class="wellness-stat-label">Avg Alertness</div></div>
      </div>
    </div>
  </div>

  <!-- How It Works -->
  <div class="how-section">
    <div class="how-card">
      <h3>How It Works</h3>
      <div class="how-grid">
        <div>
          <h4>Eye Aspect Ratio (EAR) Formula:</h4>
          <code>EAR = (|p2-p6| + |p3-p5|) / (2 √ó |p1-p4|)</code>
          <p style="margin-top:8px;font-size:14px;color:#6b7a8d">When EAR drops below 0.25 for 2-3 seconds, drowsiness is detected.</p>
        </div>
        <div>
          <h4>Detection Features:</h4>
          <ul>
            <li>68-point facial landmark detection</li>
            <li>Real-time EAR &amp; MAR calculation</li>
            <li>Micro-sleep detection</li>
            <li>Head pose monitoring</li>
            <li>Multi-factor drowsiness scoring</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-grid">
      <div class="footer-brand">
        <h3>üëÅ Vigilance Driver</h3>
        <p>Driver drowsiness detection system using advanced facial landmark analysis and Eye Aspect Ratio (EAR) technology to keep drivers safe on the road.</p>
        <div class="footer-tags"><span>üõ° Privacy First</span><span>‚ö° Real-time</span></div>
      </div>
      <div class="footer-col">
        <h4>Features</h4>
        <ul><li>EAR-based Detection</li><li>Micro-sleep Alerts</li><li>Yawn Detection</li><li>Head Pose Tracking</li><li>Session Analytics</li></ul>
      </div>
      <div class="footer-col">
        <h4>Technology</h4>
        <ul><li>face-api.js</li><li>68-point Landmarks</li><li>Web Audio API</li><li>Flask + MongoDB</li><li>Real-time Processing</li></ul>
      </div>
    </div>
    <div class="footer-copy">¬© 2026 Vigilance Driver - Driver Drowsiness Detection System. All rights reserved.</div>
  </footer>

  <script src="app.js"></script>
</body>
</html>
